class Wort{constructor(parent){this.space=$("svg").width(),parent instanceof Phrase?(this.parent=parent,this.parentdiv=parent.div):(this.parent=null,this.parentdiv=parent),this.wortkategorie=jQuery("<div/>",{class:"input"}).appendTo("body");var tobject=this,json=[{value:"/",text:"-"},{value:"N",text:"Nomen (N)"},{value:"V",text:"Verb (V)"},{value:"VV",text:"Vollverb (VV)"},{value:"MV",text:"Modalverb (MV)"},{value:"Aux",text:"Auxiliar (Aux)"},{value:"IV",text:"infinites Verb (IV)"},{value:"Adj",text:"Adjektiv (Adj)"},{value:"Art",text:"Atrikel (Art)"},{value:"Adv",text:"Adverb (Adv)"},{value:"Präp",text:"Präposition (Präp)"},{value:"Pron",text:"Pronomen (Pron)"},{value:"Konj",text:"Konjunktionen (Konj)"},{value:"Part",text:"Partikel (Part)"}],dselect=$("<select></select>").attr("class","select");$.each(json,(function(index,json){dselect.append($("<option></option>").attr("value",json.value).text(json.text))})),this.kategorie=dselect,this.kategorie.resizeselect(),this.wortkategorie_value="",this.kategorie.on("change",(function(){tobject.wortkategorie_value=this.value})),this.wortkategorie.append(this.kategorie),this.wortlinie=document.createElementNS("http://www.w3.org/2000/svg","line"),this.wortlinie.setAttribute("class","linie"),$("#svg").append(this.wortlinie),this.wortlinie2=document.createElementNS("http://www.w3.org/2000/svg","line"),this.wortlinie2.setAttribute("class","linie"),$("#svg").append(this.wortlinie2),this.wortinput=jQuery("<div/>",{class:"input",style:"margin : 0 auto;"}).appendTo("body"),this.wortfeld=$("<input>").attr({name:"wort",class:"select",type:"text",style:"margin : 0 auto;"}).appendTo(this.wortinput),this.wortfeld_value="",this.wortfeld.on("change",(function(){tobject.wortfeld_value=this.value})),this.drag()}json(){var x;return{type:this.type,kategorie:this.wortkategorie_value,wort:this.wortfeld_value,x:this.x,y:this.y}}calcChildpos(){}drag(){var x=this.parentdiv.offset().left+this.parentdiv.width()/2,y=this.parentdiv.offset().top+this.parentdiv.height()/2,px=this.parentdiv.offset().left+this.parentdiv.width()/2,py=this.parentdiv.offset().top+this.parentdiv.height()/2;this.wortlinie.setAttribute("x1",x),this.wortlinie.setAttribute("y1",y-1),this.wortlinie.setAttribute("x2",x),this.wortlinie.setAttribute("y2",y+2*this.wortkategorie.height());var y2=2*this.wortkategorie.height()+y;this.wortkategorie.css("left",x-this.wortkategorie.width()/2),this.wortkategorie.css("top",y2);var y3=2*this.wortinput.height()+y2;this.wortlinie2.setAttribute("x1",x),this.wortlinie2.setAttribute("y1",y2+this.wortkategorie.height()+1),this.wortlinie2.setAttribute("x2",x),this.wortlinie2.setAttribute("y2",y3),this.wortinput.css("left",x-this.wortinput.width()/2),this.wortinput.css("top",y3)}stop(){}remove(){this.wortkategorie.remove(),this.wortinput.remove(),this.wortlinie2.remove(),this.wortlinie.remove()}setPos(x,y){this.wortkategorie.css("left",x),this.wortkategorie.css("top",y),this.drag()}setWort(value){this.wortfeld_value=value,this.wortfeld.val(this.wortfeld_value),this.wortfeld.resizetext()}setWortkategorie(value){this.wortkategorie_value=value,this.kategorie.val(value),this.kategorie.resizeselect()}getPosX(){return this.wortkategorie.offset().left}getPosY(){return this.wortkategorie.offset().top}addtoPos(mx,my){this.setPos(this.getPosX()+mx,this.getPosY()+my)}setspace(newspace){this.space=newspace}}class Phrase{constructor(parent,type,label){var tobject=this;if(this.space=$("svg").width(),null==parent?(this.parent=null,this.parentdiv=null):parent instanceof Phrase?(this.parent=parent,this.parentdiv=parent.div):(this.parent=null,this.parentdiv=parent),this.type=type,this.label=void 0===label?"":label,this.childs=[],this.div=jQuery("<div/>",{class:"drag "+this.type.replace(/\W/g,""),html:this.type+this.label}).appendTo("body"),null!=this.parentdiv?(this.linie=document.createElementNS("http://www.w3.org/2000/svg","line"),this.linie.setAttribute("class","linie"),$("#svg").append(this.linie)):this.linie=null,this.funktion="/",null!=parent){this.divfunc=jQuery("<div/>",{class:"input "}).appendTo("body");var json=[{value:"/",text:"-"},{value:"Sub",text:"Subjekt (Sub)"},{value:"Prä",text:"Prädikat (Prä)"},{value:"Det",text:"Determinante (Det)"},{value:"Kopf",text:"Kopf (K)"},{value:"Erg",text:"Ergänzung (Erg)"},{value:"AkkO",text:"Akkusativobjekt (AkkO)"},{value:"DatO",text:"Dativobjekt (DatO)"},{value:"GenO",text:"Genitivobjekt (GenO)"},{value:"PräpErg",text:"Präpositionale Ergänzung (PräpErg)"},{value:"Prädk",text:"Prädikativ (Prädk)"},{value:"attrib",text:"Attribut (attrib)"},{value:"aB",text:"Adverbielle Bestimmung (aB)"},{value:"koord",text:"Koordination (koord)"},{value:"subord)",text:"Subordination (subord)"},{value:"Comp)",text:"Complementiv (Comp)"}],tselect=$("<select></select>").attr("class","select");$.each(json,(function(index,json){tselect.append($("<option></option>").attr("value",json.value).text(json.text))})),this.select=tselect,this.select.on("change",(function(){tobject.funktion=this.value})),this.divfunc.append(this.select),this.select.resizeselect()}this.div.draggable({start:function(){tobject.start()},drag:function(){tobject.drag()},stop:function(){tobject.stop()}}).click((function(){$(this).is(".ui-draggable-dragging")||0==$("body").hasClass("dialog")&&tobject.newdialog()})),this.drag(),this.x=this.getPosX(),this.y=this.getPosY()}newdialog(){if(0==$(".nwidget").length){var tobject=this;this.div.addClass("selectdialogborder");var dialog=jQuery("<div/>",{class:"nwidget ",html:"Option</br>"}).appendTo("body"),s=$("<select/>");s.addClass("select2");var json=[{value:"-",text:" "}];switch(null!=this.parent?json.push({value:"delete",text:"- Element löschen -"}):(json.push({value:"save",text:"- speichern -"}),json.push({value:"check",text:"- prüfen -"}),json.push({value:"copy",text:"- duplizieren -"}),json.push({value:"load",text:"- laden -"}),json.push({value:"sort",text:"- ordnen -"})),this.type){case"dragwort":case"wort":break;default:json.push({value:"S",text:"Satz (S)"}),json.push({value:"NP",text:"Nominalphrase (NP)"}),json.push({value:"(NP) = Pron",text:"Nominalphrase (NP) = Pronomen"}),json.push({value:"VP",text:"Verbalphrase (VP)"}),json.push({value:"AP",text:"Adjektivphrase (AP)"}),json.push({value:"PP",text:"Präpositionalphrase (PP)"}),json.push({value:"wort",text:"Wort"})}$.each(json,(function(index,json){s.append($("<option></option>").attr("value",json.value).text(json.text))})),dialog.append(s),$("svg").click((function(){$(".nwidget").remove(),tobject.div.removeClass("selectdialogborder")})),s.on("change",(function(){switch(this.value){case"delete":tobject.parentremoveMe();break;case"sort":tobject.calcChildpos();break;case"copy":var exportName="Baum",exportObj=tobject.json();Phrase.dateiladen(JSON.stringify(exportObj));break;case"save":var exportName=prompt("Dateiname eingeben: ",""),exportObj;(exportObj=tobject.json()).Satz=$("textarea#Satz").val();var dataStr="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(exportObj)),downloadAnchorNode=document.createElement("a");downloadAnchorNode.setAttribute("href",dataStr),downloadAnchorNode.setAttribute("type","application/octet-stream"),downloadAnchorNode.setAttribute("download",exportName+".json"),document.body.appendChild(downloadAnchorNode),downloadAnchorNode.click(),downloadAnchorNode.remove();break;case"load":$.getJSON("https://raw.githubusercontent.com/syntaxgraph/syntaxgraph.github.io/master/Beispiel.json",(function(data){tobject.remove(),tobject=Phrase.dateiladen(data)}));break;case"check":var input=document.createElement("input");input.type="file",input.onchange=e=>{var file=e.target.files[0],reader=new FileReader;reader.readAsText(file,"UTF-8"),reader.onload=readerEvent=>{var content=readerEvent.target.result;Phrase.dateivergleich(content,tobject)?alert("Richtig!"):alert("Falsch")}},input.click();break;case"-":break;default:tobject.newChild(this.value)}s.remove(),dialog.remove(),tobject.div.removeClass("selectdialogborder")})),dialog.draggable(),dialog.css("left",this.getPosX()),dialog.css("top",this.getPosY())}}setspace(newspace){this.space=newspace,this.calcChildpos()}setlabel(newlabel){this.label=newlabel,this.div.text(this.type+this.label)}remove(){if(null!=this.div&&(this.div.fadeOut(700,(function(){$(this).remove()})),null!=this.parent)){this.divfunc.fadeOut(700,(function(){$(this).remove()})),this.select.fadeOut(700,(function(){$(this).remove()}));var tobject=this.linie;setTimeout((function(){tobject.remove()}),500)}this.childs.forEach((function(child){child.remove()}))}setPos(x,y){this.div.css("left",x),this.div.css("top",y),this.x=x,this.y=y,this.drag()}setFunktion(funktion){this.funktion=funktion,this.select.val(this.funktion),this.select.resizeselect()}addtoPos(mx,my){this.setPos(this.x+mx,this.y+my),this.childs.forEach((function(child){child.addtoPos(mx,my),child.drag()}))}getPosX(){return this.div.offset().left}getPosY(){return this.div.offset().top}setzelinie(){var div1=this.parentdiv,div2=this.div,x1=div1.offset().left+div1.width()/2,y1=div1.offset().top+div1.height()/2,x2=div2.offset().left+div2.width()/2,y2=1*div2.offset().top+div2.height()/2;this.linie.setAttribute("x1",x1),this.linie.setAttribute("y1",y1),this.linie.setAttribute("x2",x2),this.linie.setAttribute("y2",y2);var m=(y1+y2)/(x1+x2);this.divfunc.css("left",(x1+x2)/2*(1+.05*m)-this.divfunc.width()/2),this.divfunc.css("top",(y1+y2)/2*1),this.divfunc.height()}start(){this.x=this.getPosX(),this.y=this.getPosY()}stop(){var mx=this.getPosX()-this.x,my=this.getPosY()-this.y;this.childs.forEach((function(child){child.addtoPos(mx,my),child.drag()})),this.x=this.getPosX(),this.y=this.getPosY()}drag(){this.childs.forEach((function(child){child.drag()})),null!=this.parentdiv&&this.setzelinie()}calcChildpos(){var x=this.getPosX(),y=this.getPosY(),width=this.space,nr=this.childs.length,xperchild=width/nr,start=x-xperchild*((nr-1)/2);this.childs.forEach((function(child,i){var newx=start+xperchild*i;child.setspace(width/nr),child.setPos(newx,y+150),child.calcChildpos()}))}newChild(type){var typecount=1,child;if("wort"==type||"dragwort"==type)(child=new Phrase(this,"dragwort","dragwort")).childs.push(new Wort(child));else if(this.type==type){for(var i=0;i<this.childs.length;i++)this.type==type&&this.childs[i].type==type&&(this.childs[i].setlabel(typecount),typecount+=1);var child=new Phrase(this,type,typecount.toString())}else var child=new Phrase(this,type);return this.childs.push(child),this.calcChildpos(),child}ladennewChild(type){var typecount=1,child;if("wort"==type||"dragwort"==type)(child=new Phrase(this,"dragwort","dragwort")).childs.push(new Wort(child));else if(this.type==type){for(var i=0;i<this.childs.length;i++)this.type==type&&this.childs[i].type==type&&(this.childs[i].setlabel(typecount),typecount+=1);var child=new Phrase(this,type,typecount.toString())}else var child=new Phrase(this,type);return this.childs.push(child),child}parentremoveMe(child){null!=this.parent&&(this.parent.removeChild(this),this.remove())}removeChild(child){if(this.childs.splice(this.childs.indexOf(child),1),this.type==child.type){console.log("Labelkorrektur");for(var typecount=1,type=child.type,i=0;i<this.childs.length;i++)this.childs[i].type==type&&(this.childs[i].setlabel(typecount),typecount+=1)}}stringfy(){return JSON.stringify(this.json())}json(){var x=this.hjson();return x.childs=[],this.childs.forEach((function(child){x.childs.push(child.json())})),x}hjson(){var x;return{type:this.type,funktion:this.funktion,x:this.x,y:this.y}}static erzeugen(parent,data){if(data.hasOwnProperty("type")){var obj=null;return obj=null!=parent?parent.ladennewChild(data.type):new Phrase(parent,data.type,""),data.hasOwnProperty("funktion")&&null!=parent&&obj.setFunktion(data.funktion),"dragwort"==data.type?data.childs.forEach((function(element){obj.childs[0].setWort(element.wort),obj.childs[0].setWortkategorie(element.kategorie)})):data.hasOwnProperty("childs")&&data.childs.forEach((function(element){var child=Phrase.erzeugen(obj,element)})),data.hasOwnProperty("x")&&obj.setPos(data.x,data.y),obj}return null}static dateiladen(load){var data=load;return data.hasOwnProperty("Satz")&&$("textarea#Satz").val(data.Satz),Phrase.erzeugen(null,data)}static dateivergleich(load,baum){var data=JSON.parse(load);return Phrase.check(baum,data)}static check(baum,data){if("dragwort"!=data.type){if(baum.type!=data.type)return!1;if(baum.funktion!=data.funktion)return!1;if(data.hasOwnProperty("childs")){if(baum.childs.length!=data.childs.length)return!1;var kinder=!0;if(data.childs.forEach((function(datachild){var suche=!1;baum.childs.forEach((function(baumchild){Phrase.check(baumchild,datachild)&&(suche=!0)})),kinder&=suche})),0==kinder)return!1}return!0}if(baum.type!=data.type)return!1;if(baum.funktion!=data.funktion)return!1;if(baum.childs[0].wortkategorie_value!=data.childs[0].kategorie)return!1;var baumwort=baum.childs[0].wortfeld_value,datawort=data.childs[0].wort;return null!=baumwort&&(baumwort=baumwort.trim().toLowerCase()),null!=datawort&&(datawort=datawort.trim().toLowerCase()),baumwort==datawort}}$((function(){var ns="http://www.w3.org/2000/svg",svg=document.createElementNS(ns,"svg");$.fn.resizeselect=function(settings){return this.each((function(){$(this).change((function(){var $this=$(this),arrowWidth=50,text=$this.find("option:selected").text(),$test=$("<span>").html(text).css({"font-size":$this.css("font-size"),visibility:"hidden"});$test.appendTo($this.parent());var width=$test.width();$test.remove(),$this.width(width+50)})).change()}))},$(window).resize((function(){console.log("mimim")})),$.fn.resizetext=function(settings){return this.each((function(){$(this).change((function(){var $this=$(this),arrowWidth=20,text=$this.val(),$test=$("<span>").html(text).css({"font-size":$this.css("font-size"),visibility:"hidden"});$test.appendTo($this.parent());var width=$test.width();$test.remove(),$this.width(width+20)})).change()}))};var note=jQuery("<div/>",{class:"dragsatz"}).appendTo("body").draggable(),satzinput=jQuery("<textarea/>",{id:"Satz",oninput:'this.style.height = "";this.style.height = this.scrollHeight + "px"'}).css("position","absolute").css("font-size","18px").appendTo(note).on("keyup",(function(){})),S=new Phrase(null,"S");alert("Herzlich Willkommen\nDrücken Sie auf S um den Syntaxgraph zu erstellen.")}));